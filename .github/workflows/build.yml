name: Build distribution

on:
    workflow_call:
        inputs:
            config-path:
                required: false
                type: string

jobs:
    build:
        name: Build wheels on ${{ matrix.os }} ${{ matrix.python }} ðŸ“¦
        runs-on: ${{ matrix.os }}
        
        strategy:
            matrix:
                os: [ubuntu-latest, windows-latest]
                python: ["3.9", "3.10", "3.11", "3.12"]
    
        steps:
            - uses: actions/checkout@v4

            - name: Set up Python ${{ matrix.python }} ${{ matrix.os }}
              uses: actions/setup-python@v5


            # You can test your matrix by printing the current Python version
            - name: Display Python version
              run: python -c "import sys; print(sys.version)"

            - name: Install cibuildwheel
              run: python -m pip install cibuildwheel==2.18.1              

            - name: Install development requirements
              run: python -m pip install -r requirements_dev.txt

            # - name: "Install locally for testing"
            #   run: python setup.py test  

            # - name: "Compile Cython file"
            #   run: python setup.py build_ext

            - name: Build wheels
              uses: pypa/cibuildwheel@711a3d017d0729f3edde18545fee967f03d65f65  # v2.18.0
              env:
                CIBW_PRERELEASE_PYTHONS: True
                CIBW_BUILD: ${{ matrix.python }}-${{ matrix.os }}

            - name: Store the distribution packages
              uses: actions/upload-artifact@v3
              with:
                name: python-package-distributions
                path: dist/   